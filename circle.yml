general:
  branches:
    only:
      - test_branche

machine:
  python:
    version: 2.6.8
  environment:
    MY_SECURITY_GROUP: 'sg-8e9fffeb' 

dependencies:
  pre:
    - pip install awscli
    - pip install fabric
    - pip install requests

test:
  override:
    - ls
    - fab -f ./ci_tools/fabfile.py test_task
    - fab -f ./ci_tools/fabfile.py open_sg
    - fab -f ./ci_tools/fabfile.py -H root@52.69.101.160 deploy
    - fab -f ./ci_tools/fabfile.py close_sg

deployment:
  staging:
    branch: test_branche
    commands:
      - fab --fabfile ./ci_tools/fabfile.py git_merge
