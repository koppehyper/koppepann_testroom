general:
  branches:
    only:
      - test_branche
  build_dir: ci_tools

machine:
  python:
    version: 2.6.8
  environment:
    MY_SECURITY_GROUP: 'sg-8e9fffeb' 

dependencies:
  pre:
    - pip install awscli
    - pip install fabric
    - pip install requests

test:
  pre:
    - echo 'PRE TEST START'
    - fab test_task
    - fab open_sg
    - fab -H root@52.69.101.160 deploy
    - fab close_sg
    - ./raise_error.sh
    - echo 'PRE TEST END'
  post:
    - echo 'POST TEST START'
    - ./raise_error.sh
    - echo 'POST TEST END'

deployment:
  staging:
    branch: test_branche
    commands:
      - fab git_merge
      - fab slack