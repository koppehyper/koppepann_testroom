general:
  branches:
    only:
      - test_branche
      - master

machine:
  python:
    version: 2.6.8
  environment:
    MY_SECURITY_GROUP: 'sg-8e9fffeb' 

dependencies:
  pre:
    - pip install awscli
    - pip install fabric
    - pip install requests

test:
  override:
    - fab test_task
    - fab open_sg
    - ssh root@52.69.101.160 'hostname'
    - fab close_sg

deployment:
  staging:
    branch: test_branche
    commands:
      - git config --global user.name 'Koppe Pan'
      - git config --global user.email 'koppehyper@gmail.com'
      - ./hub pull-request -m 'Test PullRequest'
      - git checkout master
      - git pull
      - git merge --no-ff ${CIRCLE_BRANCH} -m 'Merge master'
      - git push origin master
      - git push origin :${CIRCLE_BRANCH}
  master_branch:
    branch: master
    commands:
      - python send_msg.py
