general:
  branches:
    only:
      - test_branche
      - master

machine:
  python:
    version: 2.6.8

dependencies:
  pre:
    - pip install awscli
    - pip install fabric
    - pip install requests

test:
  override:
    - echo $MYIP
    - fab test_task
    - aws ec2 describe-security-groups --group-id 'sg-8e9fffeb'

deployment:
  staging:
    branch: test_branche
    commands:
      - dig +short myip.opendns.com @resolver1.opendns.com
      - git config --global user.name 'Koppe Pan'
      - git config --global user.email 'koppehyper@gmail.com'
      - ./hub pull-request -m 'Test PullRequest'
      - git checkout master
      - git pull
      - git merge --no-ff ${CIRCLE_BRANCH} -m 'Merge master'
      - git push origin master
      - git push origin :${CIRCLE_BRANCH}
  master_branch:
    branch: master
    commands:
      - python send_msg.py
